<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dao.EleConWeibiaoDao">

    <resultMap type="com.entity.EleConWeibiao" id="EleConWeibiaoMap">
        <result property="id" column="id" jdbcType="INTEGER"/>
        <result property="rid" column="rid" jdbcType="VARCHAR"/>
        <result property="areaName" column="area_name" jdbcType="VARCHAR"/>
        <result property="consNo" column="cons_no" jdbcType="VARCHAR"/>
        <result property="consName" column="cons_name" jdbcType="VARCHAR"/>
        <result property="papRDiff" column="pap_r_diff" jdbcType="NUMERIC"/>
        <result property="tFactor" column="t_factor" jdbcType="NUMERIC"/>
        <result property="tgNo" column="tg_no" jdbcType="VARCHAR"/>
        <result property="tgName" column="tg_name" jdbcType="VARCHAR"/>
        <result property="orgNo" column="org_no" jdbcType="VARCHAR"/>
        <result property="orgName" column="org_name" jdbcType="VARCHAR"/>
    </resultMap>

    <!--查询单个-->
    <select id="queryById" resultMap="EleConWeibiaoMap">
        select
          id,rid,area_name,cons_no, cons_name,pap_r_diff, t_factor,tg_no,tg_name,org_no,org_name
        from dws_elecon.ele_con_weibiao
        where id = #{id}
    </select>
    <select id="queryByConsNo" parameterType="java.util.List" resultType="string">
        select
          rid
        from dws_elecon.ele_con_weibiao
        where cons_no = #{consNo}
    </select>

    <!--查询单个-->
    <select id="queryByRid" resultMap="EleConWeibiaoMap">
        select
        id, rid, area_name, cons_no, cons_name,pap_r_diff, t_factor,tg_no,tg_name,org_no,org_name
        from dws_elecon.ele_con_weibiao
        where rid in
        <foreach collection="list" item="rid" index="index" open="(" close=")" separator=",">
            #{rid}
        </foreach>
    </select>

    <select id="queryByTgOrg" parameterType="java.util.List" resultType="string">
        select
        rid
        from dws_elecon.ele_con_weibiao
        <where>
            <if test="tgNo != null and tgNo != ''">
                and tg_no = #{tgNo}
            </if>
            <if test="orgNo != null and orgNo != ''">
                and org_no = #{orgNo}
            </if>
        </where>
    </select>

    <select id="queryAreaByTgOrg" resultType="java.lang.String">
        select
        area_code
        from dws_elecon.area_code_type
        where area_name = (select distinct area_name from dws_elecon.ele_con_weibiao
        <where>
            <if test="tgNo != null and tgNo != ''">
                and tg_no = #{tgNo}
            </if>
            <if test="orgNo != null and orgNo != ''">
                and org_no = #{orgNo}
            </if>
        </where>)
    </select>

    <!--查询指定行数据-->
    <select id="queryAllByLimit" resultMap="EleConWeibiaoMap">
        select
          id, rid, area_name, cons_no, cons_name,pap_r_diff, t_factor,tg_no,tg_name,org_no,org_name
        from dws_elecon.ele_con_weibiao
        limit #{offset}, #{limit}
    </select>

    <!--查询指定行数据-->
    <select id="queryAreaName" resultType="java.lang.String">
        select
        area_code
        from dws_elecon.area_code_type
        where area_name = #{areaName}
    </select>

    <select id="queryByAreaNo" resultType="java.lang.String">
        select
        area_name
        from dws_elecon.area_code_type
        where area_code = #{areaCode}
    </select>

    <select id="selectIdByConsNo" parameterType="java.util.List" resultType="string">
        select rid from dws_elecon.ele_con_weibiao where cons_no in
        <foreach collection="list" item="no" index="index" open="(" close=")" separator=",">
            #{no}
        </foreach>
    </select>

    <select id="queryAllByConsNo" resultMap="EleConWeibiaoMap">
    select id, rid, area_name, cons_no, cons_name,pap_r_diff, t_factor,tg_no,tg_name,org_no,org_name
    from dws_elecon.ele_con_weibiao where cons_no in
    <foreach collection="list" item="no" index="index" open="(" close=")" separator=",">
        #{no}
    </foreach>
</select>

<!--    <select id="queryAllResult" resultMap="EleConWeibiaoMap">-->
<!--        select a.rid, a.area_name, a.cons_no, a.cons_name, a.event_time,b.pap_r_diff,a.t_factor,-->
<!--        case-->
<!--        when b.pap_r_diff*a.t_factor is null then 0-->
<!--        when b.pap_r_diff*a.t_factor<![CDATA[>=]]>0 then b.pap_r_diff*a.t_factor-->
<!--        when b.pap_r_diff*a.t_factor<![CDATA[<]]>0 then 0 end as ele-->
<!--        from (select * from dws_elecon.ele_con_weibiao where rid in (select rid from dws_elecon.ele_con_result group by rid)) a-->
<!--        left join dws_elecon.ele_con_result b on a.event_time = to_char(b.event_time,'hh24:mi:ss')-->
<!--        order by a.rid,a.event_time-->
<!--    </select>-->
    <!--通过实体作为筛选条件查询-->
    <select id="queryAll" resultMap="EleConWeibiaoMap">
        select
        id, rid, area_name, cons_no, cons_name,pap_r_diff, t_factor,tg_no,tg_name,org_no,org_name
        from dws_elecon.ele_con_weibiao
        <where>
            <if test="id != null">
                and id = #{id}
            </if>
            <if test="rid != null and rid != ''">
                and rid = #{rid}
            </if>
            <if test="areaName != null and areaName != ''">
                and area_name = #{areaName}
            </if>
            <if test="consNo != null and consNo != ''">
                and cons_no = #{consNo}
            </if>
            <if test="consName != null and consName != ''">
                and cons_name = #{consName}
            </if>
            <if test="papRDiff != null">
                and pap_r_diff = #{papRDiff}
            </if>
            <if test="tFactor != null">
                and t_factor = #{tFactor}
            </if>
        </where>
    </select>

    <!--新增所有列-->
    <insert id="insert" keyProperty="id" useGeneratedKeys="true">
        insert into dws_elecon.ele_con_weibiao(rid, area_name, cons_no, cons_name, event_time, pap_r_diff, t_factor)
        values (#{rid}, #{areaName}, #{consNo}, #{consName}, #{papRDiff}, #{tFactor})
    </insert>

    <insert id="insertBatch" keyProperty="id" useGeneratedKeys="true">
        insert into dws_elecon.ele_con_weibiao(rid, area_name, cons_no, cons_name, pap_r_diff, t_factor)
        values
        <foreach collection="entities" item="entity" separator=",">
            (#{entity.rid}, #{entity.areaName}, #{entity.consNo}, #{entity.consName},
            #{entity.papRDiff}, #{entity.tFactor})
        </foreach>
    </insert>

    <insert id="insertOrUpdateBatch" keyProperty="id" useGeneratedKeys="true">
        insert into dws_elecon.ele_con_weibiao(rid, area_name, cons_no, cons_name, pap_r_diff, t_factor)
        values
        <foreach collection="entities" item="entity" separator=",">
            (#{entity.rid}, #{entity.areaName}, #{entity.consNo}, #{entity.consName},
            #{entity.papRDiff}, #{entity.tFactor})
        </foreach>
        on duplicate key update
        rid = values(rid) , area_name = values(area_name) , cons_no = values(cons_no) , cons_name = values(cons_name) ,
        pap_r_diff = values(pap_r_diff) , t_factor = values(t_factor)
    </insert>

    <!--通过主键修改数据-->
    <update id="update">
        update dws_elecon.ele_con_weibiao
        <set>
            <if test="rid != null and rid != ''">
                rid = #{rid},
            </if>
            <if test="areaName != null and areaName != ''">
                area_name = #{areaName},
            </if>
            <if test="consNo != null and consNo != ''">
                cons_no = #{consNo},
            </if>
            <if test="consName != null and consName != ''">
                cons_name = #{consName},
            </if>
            <if test="papRDiff != null">
                pap_r_diff = #{papRDiff},
            </if>
            <if test="tFactor != null">
                t_factor = #{tFactor},
            </if>
        </set>
        where id = #{id}
    </update>

    <!--通过主键删除-->
    <delete id="deleteById">
        delete from dws_elecon.ele_con_weibiao where id = #{id}
    </delete>

</mapper>