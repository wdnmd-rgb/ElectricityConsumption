<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title></title>
		<link rel="stylesheet" href="layui/css/layui.css">
	</head>
	<body>
		<form class="layui-form" style="padding-top: 30px;text-align:center;" id="complain_search">
		<div class="layui-form-item">
		    <div class="layui-inline">
		        <input type="text" name="no" required  lay-verify="required" placeholder="请输入台区编号或供电所编号" 
				autocomplete="off" class="layui-input" style="width: 300px;" id="no">
		    </div>
			<div class="layui-inline"> <!-- 注意：这一层元素并不是必须的 -->
			  <input type="text" class="layui-input" id="date" name="date">
			</div>
			<div class="layui-inline">
				<button id="search" class="layui-btn" lay-submit
						lay-filter="provinceSearch">查找</button>
			</div>
			<div class="layui-inline" style="display: none" id="testDiv2"> <!-- 注意：这一层元素并不是必须的 -->
				<a class="layui-btn"  href="" download id="update">下载结果</a>
			</div>
			</div>
			<div class="layui-inline">
				<label class="layui-form-label">选择：</label>
				    <div class="layui-input-block">
				      <input type="radio" name="noType"  value="tgNo" title="台区编号" checked>
				      <input type="radio" name="noType" value="orgNo" title="供电所编号">
				    </div>
			</div>
			<div class="layui-inline">
				<select name="index" lay-verify="required" id="index">
					<option value="1">请选择时间间隔</option>
					<option value="1">15分钟</option>
					<option value="4">1小时</option>
					<option value="8">2小时</option>
					<option value="12">3小时</option>
				</select>
			</div>
		</form>
		<div style="display: none" id="testDiv">
			<table class="layui-hide" id="test" ></table>
		</div>
		<script src="js/jquery-3.4.1.js"></script>
		<script src="layui/layui.js"></script>
		<script src="js/echarts.min.js"></script>
		<script type="text/javascript">

			var option;

			layui.use(['laydate', 'form','table'],function(){
				var form = layui.form;
				var laydate = layui.laydate;
				var table = layui.table;

				//执行一个laydate实例
				laydate.render({
					elem: '#date' ,//指定元素
					value:new Date()
					,min: -10
					,max:0
				});
				table.render({
					id:"testReload"
					,elem: '#test'
					,url:'ele/queryRealEle'
					,cellMinWidth: 80 //全局定义常规单元格的最小宽度，layui 2.2.1 新增
					,cols: [[
						{field:'rid',title: '数据ID'}
						,{field:'consNo',title: '用户编号'}
						,{field:'consName',title: '用户名称'}
						,{field:'areaName',title: '区域'}
						,{field:'tFactor', title: '倍率'} //minWidth：局部定义当前单元格的最小宽度，layui 2.2.1 新增
						,{field:'eventTime', title: '时间', sort: true}
						,{field:'ua', title: 'ua'}
						,{field:'ub', title: 'ub'}
						,{field:'uc',title: 'uc'}
						,{field:'ia', title: 'ia'}
						,{field:'ib', title: 'ib'}
						,{field:'ic',title: 'ic'}
						,{field:'i0',title: 'i0'}
						,{field:'p',title: 'p'}
						,{field:'pa', title: 'pa'}
						,{field:'pb', title: 'pb'}
						,{field:'pc',title: 'pc'}
						,{field:'q',title: 'q'}
						,{field:'qa', title: 'qa'}
						,{field:'qb', title: 'qb'}
						,{field:'qc',title: 'qc'}
						,{field:'tgName',title: '台区名称'}
						,{field:'orgName',title: '供电所名称'}
					]]
					,page:true
					,limit:10
				});

				form.render();
				form.on('submit(provinceSearch)', function(data) {
					$("#testDiv2").css("display","none");
					var traget=document.getElementById("testDiv");
					traget.style.display="";
					var formData = data.field;
					var no = formData.no;
					var date = formData.date;
					var noType = $("input[name='noType']:checked").val();
					var index = $("#index").val();
					var tgNo = "";
					var orgNo = "";
					if(noType == "tgNo"){
						tgNo = no;
					}else{
						orgNo = no;
					}
					table.reload('testReload', {
						where: {
							tgNo:tgNo,
							orgNo:orgNo,
							date:date,
							index:index
						},
						url: 'ele/queryTgOrg',
						method: 'post',
                        done:function (res) {
                            $("#testDiv").css("display","");
							$("#testDiv2").css("display","");
                            console.log(res.msg);
                            $("#update").attr("href",res.msg[0]);
                        }
					});
					return false;
				});
			});
		</script>
	</body>
</html>
